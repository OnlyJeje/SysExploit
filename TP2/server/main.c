#include "include.h"

int main(int ac, char *av)
{
  printf("%s\n", "Hello World");

  int server_socket;
  int acceptfd;
  int addrlen;
  FILE *fd;
  
  char data[2000];
  struct sockaddr_in sockaddr;
  struct sockaddr_in sockclient;
  
  sockaddr.sin_family = AF_INET;
  sockaddr.sin_port = htons(1234);
  inet_aton("127.0.0.1", &sockaddr.sin_addr);
  
  server_socket = socket(AF_INET, SOCK_STREAM,0);
  bind(server_socket, (struct sockaddr*)&sockaddr, sizeof(sockaddr));
  
  if (server_socket == -1)
    {
      printf("%s\n", "Erreur à la création du socket, ABORT");
      return(-1);
    }

  listen(server_socket, 5);

  while (1)
    {
      addrlen = sizeof(struct sockaddr_in);
      acceptfd = accept(server_socket, (struct sockaddr *)&sockclient, &addrlen);
      printf("Connection accepted from %d\n", server_socket);
      while(recv(acceptfd, data, sizeof(data), 0) > 0) 
	{
	  fd = fopen("recv.txt", "w");
	  //	  printf("%s\n", data);
	  fprintf(fd, "%s", data);
	  fclose(fd);
	}
    }
}
